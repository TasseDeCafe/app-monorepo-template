[build]
builder = "railpack"
buildCommand = """
pnpm install --frozen-lockfile && \
if [ "$RAILWAY_ENVIRONMENT_NAME" = "production" ]; then \
  BUILD_ENV=production pnpm turbo run build --filter=@template-app/web; \
else \
  VITE_API_HOST="https://template-appbackend-${RAILWAY_ENVIRONMENT_NAME}.up.railway.app" \
  BUILD_ENV=preview \
  pnpm turbo run build --filter=@template-app/web; \
fi
"""

[deploy]
startCommand = "node apps/web/server.js"
healthcheckPath = "/"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5